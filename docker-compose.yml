version: '3.8'
services:
  odds-mentor-mongo-db:
    image: mongo
    container_name: odds-mentor-mongo-db
    ports:
      - "8088:27017"
    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: password
      MONGO_INITDB_DATABASE: odds-mentor
    volumes:
      - mongo-data:/data/db
      - ./mongo-entrypoint.sh:/docker-entrypoint-initdb.d/mongo-init.sh:ro
    command: mongod

  rabbitmq:
    image: rabbitmq:management
    ports:
      - "5673:5672"
      - "15673:15672"

  mentor-api:
    image: swr.ap-southeast-2.myhuaweicloud.com/odds-booking/api-mentor:${BRANCH_NAME}
    ports:
      - "8087:8080"
    restart: always
    depends_on:
      - odds-mentor-mongo-db
      - rabbitmq
    environment:
      - SPRING_RABBITMQ_HOST=rabbitmq
      - SPRING_PROFILES_ACTIVE=docker
      - SPRING_DATA_MONGODB_URI=${MONGO_DB}
      - RABBIT_PORT=5672
      - SENDINBLUE_TOKEN=${SENDINBLUE_TOKEN}

  mentor-web:
    image: swr.ap-southeast-2.myhuaweicloud.com/odds-booking/web-mentor:${BRANCH_NAME}
    ports:
      - "8089:80"
    restart: always
    depends_on:
      - odds-mentor-mongo-db
      - mentor-api

volumes:
  mongo-data:

      

